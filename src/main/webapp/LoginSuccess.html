<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" type="text/css" href="LoginSuccess.css">
</head>
<body>
<h2>书籍信息表格</h2>

<table border="1" id="bookTable">
    <tr>
        <th>书名</th>
        <th>作者</th>
        <th>国籍</th>
        <th>操作</th> <!-- 新增按钮列 -->
    </tr>
</table>
<button onclick=window.location.href='add.html'>添加</button>
<button onclick="window.location.href='/JAVA_FINAL_WORK/exit'">退出系统</button>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    // 发送 GET 请求获取数据
    axios.get("http://10.69.219.123:8080/JAVA_FINAL_WORK/DatabaseReader")
        .then(function (response) {
            // 处理成功响应
            var booksData = response.data;

            // 填充表格数据
            for (var i = 0; i < booksData.length; i++) {
                var table = document.getElementById('bookTable');
                var row = table.insertRow(-1);

                var bookCell = row.insertCell(0);
                bookCell.innerHTML = booksData[i].book;

                var authorCell = row.insertCell(1);
                authorCell.innerHTML = booksData[i].author;

                var nationCell = row.insertCell(2);
                nationCell.innerHTML = booksData[i].nation;

                // 创建按钮
                var operationCell = row.insertCell(3);
                var modifyButton = document.createElement("button");
                modifyButton.innerHTML = "修改";
                // 添加事件监听器或将其链接到执行修改的函数
                modifyButton.onclick = function (book, author, nation) {
                    return function () {
                        // 在这里添加修改的逻辑
                        console.log("点击了修改按钮，书名：" + book + "，作者：" + author + "，国籍：" + nation);
                        // 将书籍信息作为参数传递给 xiugai.html
                        window.location.href = 'xiugai.html?book=' + encodeURIComponent(book) +
                            '&author=' + encodeURIComponent(author) +
                            '&nation=' + encodeURIComponent(nation);
                    };
                }(booksData[i].book, booksData[i].author, booksData[i].nation);
                operationCell.appendChild(modifyButton);

                var deleteButton = document.createElement("button");
                deleteButton.innerHTML = "删除";
                // 添加事件监听器或将其链接到执行删除的函数
                deleteButton.onclick = function (book, author, nation) {
                    return function () {
                        // 发送 DELETE 请求
                        axios.post("http://10.69.219.123:8080/JAVA_FINAL_WORK/Delete", {
                            data: {
                                book: book,
                                author: author,
                                nation: nation
                            }
                        })
                            .then(function (response) {
                                // 处理删除成功的逻辑，刷新页面
                                console.log("删除成功", response);
                                window.location.reload();
                            })
                            .catch(function (error) {
                                // 处理删除失败的逻辑
                                console.error("删除失败", error);
                            });
                    };
                }(booksData[i].book, booksData[i].author, booksData[i].nation);
                operationCell.appendChild(deleteButton);
            }
        })
        .catch(function (error) {
            // 处理错误响应
            console.error('获取数据时出错：', error);
        });
</script>

</body>
</html>
